<div class="container-fluid margintop">
  <hr />
  <div class="row">
    <div class="col-auto">
      <img
        src="img/report.jpg"
        alt="TrainingReport"
        width="180px"
        height="180px"
      />
    </div>
    <div class="col-auto">
      <h2>Training Reports</h2>
      <p>You can download report by selection:</p>
    </div>
  </div>
  <hr />
  <app-toast></app-toast>
  <div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12">
      <div class="card mb-4">
        <div class="card-body bg-primary bg-opacity-50">
          <h5 class="card-title">Yearly Trainings Count</h5>
          <div id="chart1">
            <apx-chart
              [series]="trendTrainings.series"
              [chart]="trendTrainings.chart"
              [dataLabels]="trendTrainings.dataLabels"
              [plotOptions]="trendTrainings.plotOptions"
              [yaxis]="trendTrainings.yaxis"
              [xaxis]="trendTrainings.xaxis"
              [fill]="trendTrainings.fill"
              [title]="trendTrainings.title"
            ></apx-chart>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12">
      <div class="card mb-4">
        <div class="card-body bg-primary bg-opacity-50">
          <h5 class="card-title">Yearly Clients Trainings</h5>
          <div id="chart2">
            <apx-chart
              [series]="trendTrainingsStacked.series"
              [chart]="trendTrainingsStacked.chart"
              [dataLabels]="trendTrainingsStacked.dataLabels"
              [plotOptions]="trendTrainingsStacked.plotOptions"
              [responsive]="trendTrainingsStacked.responsive"
              [xaxis]="trendTrainingsStacked.xaxis"
              [legend]="trendTrainingsStacked.legend"
              [fill]="trendTrainingsStacked.fill"
              [colors]="trendTrainingsStacked.colors"
            ></apx-chart>
          </div>
        </div>
      </div>
    </div>
  </div>
  <hr />

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-body bg-primary bg-opacity-50">
          <h5 class="card-title">Training Report All</h5>
          <form [formGroup]="formAll">
            <div class="row">
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <input
                    type="date"
                    class="form-control form-control-sm border border-primary border-3"
                    id="floatingAllFrom"
                    formControlName="startDate"
                  />
                  <label for="floatingAllFrom">From</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <input
                    type="date"
                    class="form-control form-control-sm border border-primary border-3"
                    id="floatingAllTo"
                    formControlName="endDate"
                  />
                  <label for="floatingAllTo">To</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingAllSelectcourse"
                    formControlName="courseid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of courses(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectcourse">Course</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingAllSelectcategory"
                    formControlName="categoryid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of categories(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectcategory">Category</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingAllSelectTitle"
                    formControlName="titleid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of titles(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectTitle">Program</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingAllSelectLocation"
                    formControlName="locationid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of locations(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectLocation">Locations</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingAllSelectSources"
                    formControlName="source"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of sources(); track $index) {
                    <option [value]="item">{{ item }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectSources">Source</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingAllSelectStatus"
                    formControlName="status"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of statuses(); track $index) {
                    <option [value]="item">{{ item }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectStatus">Status</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingAllSelectClient"
                    formControlName="clientid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of clients(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectClient">Sponsor</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingSelectContractor"
                    formControlName="contractorid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of filteredContractors(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingSelectContractor">Contractors</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingSelectTrainer"
                    formControlName="trainerid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of trainers(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingSelectTrainer">Trainers</label>
                </div>
              </div>
              <div class="col-auto">
                @if (apiCallInProgress()) {
                <button class="btn btn-primary" type="button" disabled>
                  <span
                    class="spinner-grow spinner-grow-sm"
                    aria-hidden="true"
                  ></span>
                  <span role="status"> Loading...</span>
                </button>
                }@else {
                <button
                  type="submit"
                  class="btn btn-primary"
                  (click)="getReportALL()"
                >
                  <i class="fa-solid fa-file-excel"></i>
                  Export
                </button>

                <button
                  type="button"
                  class="btn btn-secondary mx-1"
                  (click)="resetForm()"
                >
                  <i class="fa-solid fa-broom"></i> Reset
                </button>
                }
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  @if (financeEnabled()) {
  <div class="row">
    <div class="col-lg-4 col-md-4 col-sm-12">
      <form [formGroup]="formFinance">
        <div class="card mb-4">
          <div class="card-body bg-primary bg-opacity-50">
            <h5 class="card-title">Financial Report By Month</h5>
            <div class="card-text">
              <div class="row">
                <div class="col-auto">
                  <div class="form-floating mb-2">
                    <select
                      class="form-select form-select-sm border border-primary border-3"
                      id="floatingAllSelectmonth"
                      formControlName="month"
                    >
                      <option disabled value="null">-----Select-----</option>
                      @for (item of months(); track $index) {
                      <option [value]="item.id">{{ item.name }}</option>
                      }
                    </select>
                    <label for="floatingAllSelectmonth">Month</label>
                  </div>
                </div>
                <div class="col-auto">
                  <div class="form-floating mb-2">
                    <select
                      class="form-select form-select-sm border border-primary border-3"
                      id="floatingAllSelectyear"
                      formControlName="year"
                    >
                      <option disabled value="null">-----Select-----</option>
                      @for (item of years(); track $index) {
                      <option [value]="item">{{ item }}</option>
                      }
                    </select>
                    <label for="floatingAllSelectyear"
                      ><span class="text-danger">*</span> Year</label
                    >
                  </div>
                </div>
              </div>
              <div class="col-auto">
                @if (apiCallInProgress()) {
                <button class="btn btn-primary" type="button" disabled>
                  <span
                    class="spinner-grow spinner-grow-sm"
                    aria-hidden="true"
                  ></span>
                  <span role="status"> Loading...</span>
                </button>
                }@else {
                <button
                  class="btn btn-primary"
                  type="submit"
                  title="Export Financial Report"
                  (click)="exportFinance()"
                  [disabled]="formFinance.invalid"
                >
                  <i class="fa-solid fa-file-excel"></i> Export
                </button>
                <button
                  class="btn btn-secondary ms-1"
                  (click)="resetForm()"
                  title="Reset Filter"
                >
                  <i class="fa-solid fa-broom"></i> Reset
                </button>
                }
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="col-lg-4 col-md-4 col-sm-12">
      <div class="card mb-4">
        <div class="card-body bg-primary bg-opacity-50">
          <h5 class="card-title">Training Report</h5>
          <div class="row">
            <div class="col-auto">
              <div class="form-floating mb-2">
                <select
                  class="form-select form-select-sm border border-primary border-3"
                  id="floatingDummy1"
                >
                  <option value="null">-----Select-----</option>
                </select>
                <label for="floatingDummy1">ToBeDecided</label>
              </div>
            </div>
          </div>
          <p class="card-text">
            <button class="btn btn-primary" title="Export">
              <i class="fa-solid fa-file-excel"></i> Export
            </button>
            <button class="btn btn-secondary ms-1" title="Reset Filter">
              <i class="fa-solid fa-broom"></i> Reset
            </button>
          </p>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-4 col-sm-12">
      <div class="card mb-4">
        <div class="card-body bg-primary bg-opacity-50">
          <h5 class="card-title">Training Report</h5>
          <div class="row">
            <div class="col-auto">
              <div class="form-floating mb-2">
                <select
                  class="form-select form-select-sm border border-primary border-3"
                  id="floatingDummy2"
                >
                  <option value="null">-----Select-----</option>
                </select>
                <label for="floatingDummy2">ToBeDecided</label>
              </div>
            </div>
          </div>
          <p class="card-text">
            <button class="btn btn-primary" title="Export">
              <i class="fa-solid fa-file-excel"></i> Export
            </button>
            <button class="btn btn-secondary ms-1" title="Reset Filter">
              <i class="fa-solid fa-broom"></i> Reset
            </button>
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-body bg-primary bg-opacity-50">
          <h5 class="card-title">Financial Grid</h5>
          <form [formGroup]="formFinanceGrid">
            <div class="row">
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <input
                    type="date"
                    class="form-control form-control-sm border border-primary border-3"
                    id="floatingreceived"
                    formControlName="amountreceiveddate"
                  />
                  <label for="floatingreceived">Received Date</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <input
                    type="search"
                    class="form-control border border-primary border-3"
                    id="floatingBank"
                    placeholder="Meezan"
                    formControlName="bank"
                  />
                  <label for="floatingBank">Bank Name</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <input
                    type="search"
                    class="form-control border border-primary border-3"
                    id="floatingInvoice"
                    placeholder="0103-25-3687"
                    formControlName="invoicenumber"
                  />

                  <label for="floatingInvoice">Invoice #</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating mb-2">
                  <input
                    type="search"
                    class="form-control border border-primary border-3"
                    id="floatingCheque"
                    placeholder="35337071"
                    formControlName="cheque"
                  />
                  <label for="floatingCheque">Cheque #</label>
                </div>
              </div>
              <!-- <div class="col-auto">
                <div class="form-floating mb-2">
                  <select
                    class="form-select form-select-sm border border-primary border-3"
                    id="floatingyear"
                    formControlName="year"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of years(); track $index) {
                    <option [value]="item">{{ item }}</option>
                    }
                  </select>
                  <label for="floatingyear"
                    ><span class="text-danger">*</span> Year</label
                  >
                </div>
              </div> -->
              <div class="col-auto">
                <button
                  class="btn btn-primary"
                  title="Load Grid"
                  type="submit"
                  (click)="loadFinance()"
                  [disabled]="!formFinanceGrid.dirty"
                >
                  <i class="fa-solid fa-table-cells-column-lock"></i> Load Grid
                </button>
                <button
                  class="btn btn-secondary ms-1"
                  title="Reset Filter"
                  (click)="resetForm()"
                >
                  <i class="fa-solid fa-broom"></i> Reset
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-hover table-bordered fs-7" id="training-table">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Plan Date</th>
          <th>Name</th>
          <th>Sponsor</th>
          <th>Contractor</th>
          <th>Charged Amount</th>
          <th>Tranportation</th>
          <th>Tax</th>
          <th>Total Amount</th>
          <th>Received Amount</th>
          <th>Received Date</th>
          <th>Invoice</th>
          <th>InvoiceDate</th>
          <th>BankName</th>
          <th>Cheque</th>
        </tr>
      </thead>
      <tbody>
        @for (item of trainings(); track $index) {
        <tr>
          <td>
            <div>
              {{ $index + 1 }}
            </div>
          </td>
          <td>
            <div>
              {{ item.plandate | date }}
            </div>
          </td>
          <td>
            <div>
              {{ item.name }}
            </div>
          </td>
          <td>
            {{ genaricName(clients(), item.clientid) }}
          </td>
          <td>
            {{ genaricName(contractors(), item.contractorid) }}
          </td>
          <td>
            {{ item.charges }}
          </td>
          <td>
            {{ item.transportation }}
          </td>
          <td>
            {{ item.tax }}
          </td>
          <td>
            {{ item.total }}
          </td>
          <td>
            {{ item.amountreceived }}
          </td>
          <td>
            {{ item.amountreceiveddate | date }}
          </td>
          <td>{{ item.invoicenumber }}</td>
          <td>
            {{ item.invoicedate | date }}
          </td>
          <td>
            {{ item.bank }}
          </td>
          <td>
            {{ item.cheque }}
          </td>
        </tr>
        }@empty {
        <tr>
          <p>Please update your search criteria for items to be displayed</p>
        </tr>
        }
        <tr class="fw-bold">
          <td colspan="1">Total</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>{{ totalSummary.charges }}</td>
          <td>{{ totalSummary.transportation }}</td>
          <td>{{ totalSummary.tax }}</td>
          <td>{{ totalSummary.totalAmount }}</td>
          <td>{{ totalSummary.receivedAmount }}</td>
          <!-- <td>{{ totalSummary.tax }}</td> -->
        </tr>
      </tbody>
    </table>
  </div>
  <hr />
  }
</div>
