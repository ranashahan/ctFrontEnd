<div class="container-fluid margintop">
  <hr />
  <div class="row">
    <div class="col-auto">
      <img
        src="img/report.jpg"
        alt="Assessment Report"
        width="180px"
        height="180px"
      />
    </div>
    <div class="col-auto">
      <h2>Assessment Reports</h2>
      <p>You can download report by selection:</p>
    </div>
  </div>
  <hr />
  <app-toast />
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12">
      <div class="card mb-4">
        <div class="card-body bg-warning bg-opacity-50 text-dark">
          <h5 class="card-title">Session Report All</h5>
          <form [formGroup]="formAll">
            <div class="row my-2">
              <div class="col-auto">
                <div class="form-floating mb-3">
                  <input
                    type="date"
                    class="form-control form-control-sm border border-warning border-2"
                    id="floatingAllFrom"
                    formControlName="startDate"
                  />
                  <label for="floatingAllFrom">From</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <input
                    type="date"
                    class="form-control form-control-sm border border-warning border-2"
                    id="floatingAllTo"
                    formControlName="endDate"
                  />
                  <label for="floatingAllTo">To</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingAllSelectlicensetype"
                    formControlName="licensetypeid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of dltypes(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectlicensetype"
                    >License Types</label
                  >
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingAllSelectbloodgroup"
                    formControlName="bloodgroupid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of bloodgroups(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectbloodgroup">Blood Groups</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingAllSelectVisual"
                    formControlName="visualid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of visuals(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectVisual">Visuals</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingAllSelectLocation"
                    formControlName="locationid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of locations(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectLocation">Locations</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingAllSelectResult"
                    formControlName="resultid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of results(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectResult">Results</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingAllSelectStage"
                    formControlName="stageid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of stages(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectStage">Stages</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingAllSelectTitle"
                    formControlName="titleid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of titles(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingAllSelectTitle">Titles</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingSelectVehicle"
                    formControlName="vehicleid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of vehicles(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingSelectVehicle">Vehicles</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingSelectContractor"
                    formControlName="contractorid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of contractors(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingSelectVehicle">Contractors</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingSelectTrainer"
                    formControlName="trainerid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of trainers(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingSelectTrainer">Trainers</label>
                </div>
              </div>
              <div class="col-auto">
                @if (apiCallInProgress()) {
                <button class="btn btn-warning" type="button" disabled>
                  <span
                    class="spinner-grow spinner-grow-sm"
                    aria-hidden="true"
                  ></span>
                  <span role="status"> Loading...</span>
                </button>
                }@else {
                <button
                  type="submit"
                  class="btn btn-warning"
                  (click)="getReportALL()"
                >
                  <i class="fa-solid fa-file-export"></i>
                  Export
                </button>

                <button
                  type="button"
                  class="btn btn-secondary mx-1"
                  (click)="formAllReset()"
                >
                  <i class="fa-solid fa-broom"></i> Reset
                </button>
                }
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12">
      <div class="card mb-4">
        <div class="card-body bg-warning bg-opacity-50 text-dark">
          <h5 class="card-title">Session report by client</h5>
          <form [formGroup]="formDate">
            <div class="row">
              <div class="col-auto">
                <div class="form-floating mb-3">
                  <input
                    type="date"
                    class="form-control form-control-sm border border-warning border-2"
                    id="floatingFrom"
                    formControlName="startDate"
                  />
                  <label for="floatingFrom">From</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <input
                    type="date"
                    class="form-control form-control-sm border border-warning border-2"
                    id="floatingTo"
                    formControlName="endDate"
                  />
                  <label for="floatingTo">To</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingSelectclient"
                    formControlName="clientid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of clients(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingSelectclient">Clients</label>
                </div>
              </div>
              <div class="col-auto">
                <div class="form-floating">
                  <select
                    class="form-select form-select-sm border border-warning border-2"
                    id="floatingSelect"
                    aria-label="Floating label select example"
                    formControlName="contractorid"
                  >
                    <option disabled value="null">-----Select-----</option>
                    @for (item of filteredContractors(); track $index) {
                    <option [value]="item.id">{{ item.name }}</option>
                    }
                  </select>
                  <label for="floatingSelect">Contractors</label>
                </div>
              </div>
              <div class="col-auto">
                @if (apiCallInProgress()) {
                <button class="btn btn-warning" type="button" disabled>
                  <span
                    class="spinner-grow spinner-grow-sm"
                    aria-hidden="true"
                  ></span>
                  <span role="status"> Loading...</span>
                </button>
                }@else {
                <button
                  type="submit"
                  class="btn btn-warning"
                  (click)="getReportByDate()"
                >
                  <i class="fa-solid fa-file-export"></i>
                  Export
                </button>

                <button
                  type="button"
                  class="btn btn-secondary mx-1"
                  (click)="formDateReset()"
                >
                  <i class="fa-solid fa-broom"></i> Reset
                </button>
                }
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12">
      <div class="card mb-4">
        <div class="card-body bg-warning bg-opacity-50 text-dark">
          <h5 class="card-title">Session Certificates</h5>
          <form [formGroup]="formSession">
            <p class="card-text">
              <input
                type="search"
                class="form-control border border-warning border-2"
                id="sessionname"
                placeholder="Session ID"
                formControlName="sessionname"
              />
            </p>
            <p class="card-text">
              @if (apiCallInProgress()) {
              <button class="btn btn-warning" type="button" disabled>
                <span
                  class="spinner-grow spinner-grow-sm"
                  aria-hidden="true"
                ></span>
                <span role="status"> Loading...</span>
              </button>
              }@else {
              <button
                class="btn btn-warning"
                type="button"
                (click)="getSessionData()"
                title="Search Session"
                [disabled]="formSession.invalid"
              >
                <i class="fa-brands fa-searchengin me-1"></i>Search
              </button>
              <button
                class="btn btn-warning ms-1"
                type="button"
                (click)="downloadSessionReport()"
                title="Download PDF"
              >
                <i class="fa-solid fa-file-pdf me-1"></i>Generate Certificates
              </button>
              <!-- <button
                class="btn btn-warning ms-1"
                type="button"
                (click)="downloadDriverReport()"
                title="Download PDF"
              >
                <i class="fa-solid fa-file-pdf me-1"></i>Generate Card
              </button> -->
              <button
                class="btn btn-warning ms-1"
                type="button"
                (click)="downloadWordReport()"
                title="Download Word"
              >
                <i class="fa-solid fa-file-word me-1"></i>Generate Cards
              </button>
              }
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="table-responsive mt-3">
    <table
      class="table table-hover table-bordered fs-7"
      id="allassessment-table"
    >
      <thead class="table-warning">
        <tr>
          <th>#</th>
          <th>Session Name</th>
          <th>Session Date</th>
          <th>Driver Name</th>
          <th>Driver NIC</th>
        </tr>
      </thead>
      <tbody>
        @for (item of session(); track $index) {
        <tr>
          <td>
            <div>
              {{ $index + 1 }}
            </div>
          </td>
          <td>
            <div>
              {{ item.sessioname }}
            </div>
          </td>
          <td>
            {{ item.sessiondate | date }}
          </td>
          <td>
            <div>
              {{ item.drivername }}
            </div>
          </td>
          <td>
            <div>
              {{ item.nic }}
            </div>
          </td>
        </tr>
        }@empty {
        <tr>
          <p>Please update your search criteria for items to be displayed</p>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
